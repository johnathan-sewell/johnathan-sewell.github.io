"use strict";(self.webpackChunkjohnathan_sewell=self.webpackChunkjohnathan_sewell||[]).push([[447],{1156:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var o=t(3274),i=t(4824);const a={slug:"module-federation",title:"Module Federation",authors:"johnathan"},l=void 0,r={permalink:"/module-federation",source:"@site/blog/2023-08-02-module-federation/index.md",title:"Module Federation",description:"Sharing code between applications with Module Federation.",date:"2023-08-02T00:00:00.000Z",tags:[],readingTime:3.035,hasTruncateMarker:!0,authors:[{name:"Johnathan Sewell",url:"https://github.com/johnathan-sewell",imageURL:"https://avatars.githubusercontent.com/u/286782?v=4",key:"johnathan"}],frontMatter:{slug:"module-federation",title:"Module Federation",authors:"johnathan"},unlisted:!1,prevItem:{title:"Simple Static Site Deployment to AWS with CDK",permalink:"/static-site-deployment-with-cdk"},nextItem:{title:"Building a Quality Selector for HLS.js in React",permalink:"/hls-quality-selector"}},s={authorsImageUrls:[void 0]},d=[{value:"What is Module Federation?",id:"what-is-module-federation",level:2},{value:"Why use Module Federation?",id:"why-use-module-federation",level:2},{value:"Create a Project for the Remote Module",id:"create-a-project-for-the-remote-module",level:2},{value:"Create a Vite project",id:"create-a-vite-project",level:4},{value:"Install the Vite module federation plugin",id:"install-the-vite-module-federation-plugin",level:4},{value:"Fix the port",id:"fix-the-port",level:4},{value:"Create a VideoPlayer component",id:"create-a-videoplayer-component",level:4},{value:"Configure the Vite module federation plugin",id:"configure-the-vite-module-federation-plugin",level:4},{value:"Let&#39;s check that worked...",id:"lets-check-that-worked",level:4},{value:"Configure the Host Application",id:"configure-the-host-application",level:2},{value:"Install the Vite module federation plugin",id:"install-the-vite-module-federation-plugin-1",level:4},{value:"Configure the plugin",id:"configure-the-plugin",level:4},{value:"Import the remote Component into the Host Application",id:"import-the-remote-component-into-the-host-application",level:4},{value:"Add declaration file",id:"add-declaration-file",level:4},{value:"Run the Host Application",id:"run-the-host-application",level:4}];function c(e){const n={a:"a",code:"code",h2:"h2",h4:"h4",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Sharing code between applications with Module Federation."}),"\n",(0,o.jsx)(n.h2,{id:"what-is-module-federation",children:"What is Module Federation?"}),"\n",(0,o.jsx)(n.p,{children:"Module Federation is a way to share code between applications. It is a feature of Webpack 5 and is also available as a plugin for Vite."}),"\n",(0,o.jsx)(n.h2,{id:"why-use-module-federation",children:"Why use Module Federation?"}),"\n",(0,o.jsx)(n.p,{children:"Module Federation allows you to share code between applications. This can be useful if you have a component library that you want to share between applications. It can also be useful if you want to share a single component between applications."}),"\n",(0,o.jsx)(n.p,{children:"This has benefits over an npm module, including the ability to share state between applications and the ability to share code without publishing to npm."}),"\n",(0,o.jsx)(n.h2,{id:"create-a-project-for-the-remote-module",children:"Create a Project for the Remote Module"}),"\n",(0,o.jsx)(n.p,{children:"I'm using a video player as an example here."}),"\n",(0,o.jsx)(n.h4,{id:"create-a-vite-project",children:"Create a Vite project"}),"\n",(0,o.jsxs)(n.p,{children:["Follow these steps to ",(0,o.jsx)(n.a,{href:"/vite-project-setup",children:"setup a new Vite project"})]}),"\n",(0,o.jsx)(n.h4,{id:"install-the-vite-module-federation-plugin",children:"Install the Vite module federation plugin"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pnpm add @originjs/vite-plugin-federation -D\n"})}),"\n",(0,o.jsx)(n.h4,{id:"fix-the-port",children:"Fix the port"}),"\n",(0,o.jsx)(n.p,{children:"This is so that we can point a host application here."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'"scripts": {\n    "dev": "vite --port 5001 --strictPort",\n},\n'})}),"\n",(0,o.jsx)(n.h4,{id:"create-a-videoplayer-component",children:"Create a VideoPlayer component"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",children:'import { useState } from "react";\n\nfunction VideoPlayer({ src }) {\n  const [count, setCount] = useState(0);\n\n  return (\n    <>\n      <h1>Video Player Module</h1>\n      <div>\n        <video width="250" autoPlay muted>\n          <source src={src} type="video/webm" />\n        </video>\n      </div>\n\n      <button onClick={() => setCount((count) => count + 1)}>\n        count is {count}\n      </button>\n    </>\n  );\n}\n\nexport default VideoPlayer;\n'})}),"\n",(0,o.jsx)(n.h4,{id:"configure-the-vite-module-federation-plugin",children:"Configure the Vite module federation plugin"}),"\n",(0,o.jsxs)(n.p,{children:["Add the configuration to the plugins array of ",(0,o.jsx)(n.code,{children:"vite.config.js"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import { defineConfig } from "vite";\nimport react from "@vitejs/plugin-react";\nimport basicSsl from "@vitejs/plugin-basic-ssl";\nimport federation from "@originjs/vite-plugin-federation";\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  server: {\n    port: 3000,\n    https: true,\n  },\n  plugins: [\n    react(),\n    /* install for local SSL*/\n    /* pnpm add @vitejs/plugin-basic-ssl -D */\n    basicSsl(),\n    federation({\n      name: "video_player_module",\n      // file name for the manifest file, defaults to remoteEntry.js\n      filename: "remoteEntry.js",\n      exposes: {\n        // expose each component you want to share\n        // path to the component: name of the component\n        "./VideoPlayer": "./src/VideoPlayer",\n      },\n      //  share react and react-dom from the host\n      shared: ["react", "react-dom"],\n    }),\n  ],\n  build: {\n    outDir: "dist",\n    modulePreload: false,\n    target: "esnext",\n    minify: false,\n    cssCodeSplit: false,\n  },\n});\n'})}),"\n",(0,o.jsx)(n.h4,{id:"lets-check-that-worked",children:"Let's check that worked..."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pnpm build && pnpm preview\n"})}),"\n",(0,o.jsxs)(n.p,{children:['Then browse to "',(0,o.jsx)(n.a,{href:"https://localhost:5001/assets/remoteEntry.js",children:"https://localhost:5001/assets/remoteEntry.js"}),'" and you should see a manifest file.']}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Manifest",src:t(4059).A+"",width:"2950",height:"530"})}),"\n",(0,o.jsxs)(n.p,{children:["It's important to note you need to run ",(0,o.jsx)(n.code,{children:"pnpm build"})," to generate the manifest file."]}),"\n",(0,o.jsx)(n.h2,{id:"configure-the-host-application",children:"Configure the Host Application"}),"\n",(0,o.jsx)(n.h4,{id:"install-the-vite-module-federation-plugin-1",children:"Install the Vite module federation plugin"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pnpm add @originjs/vite-plugin-federation -D\n"})}),"\n",(0,o.jsx)(n.h4,{id:"configure-the-plugin",children:"Configure the plugin"}),"\n",(0,o.jsxs)(n.p,{children:["Configure the plugin in ",(0,o.jsx)(n.code,{children:"vite.config.js"})," by adding the plugin to the plugins array:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import federation from "@originjs/vite-plugin-federation";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    basicSsl() /* local SSL */,\n    federation({\n      name: "host",\n      remotes: {\n        videoPlayerModule: "https://localhost:5001/assets/remoteEntry.js",\n      },\n      shared: ["react", "react-dom"], //  share react and react-dom from the host\n    }),\n  ],\n  // ... rest of your config\n});\n'})}),"\n",(0,o.jsx)(n.h4,{id:"import-the-remote-component-into-the-host-application",children:"Import the remote Component into the Host Application"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",children:'import { useState } from "react";\n// eslint-disable-next-line import/no-unresolved\nimport VideoPlayer from "videoPlayerModule/VideoPlayer"; // can use React.lazy here\n\nexport default function ModuleFederationPage() {\n  const [count, setCount] = useState(0);\n\n  return (\n    <>\n      <h1>Module Federation Host</h1>\n      <button onClick={() => setCount((count) => count + 1)}>\n        count is {count}\n      </button>\n      <VideoPlayer src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm" />\n    </>\n  );\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"add-declaration-file",children:"Add declaration file"}),"\n",(0,o.jsx)(n.p,{children:"For TypeScript, you need to add a declaration file to the host application (declarations.d.ts):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'declare module "videoPlayerModule/VideoPlayer" {\n  const VideoPlayer: React.ComponentType<{ src: string }>;\n  export default VideoPlayer;\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"run-the-host-application",children:"Run the Host Application"}),"\n",(0,o.jsx)(n.p,{children:"Run the host application and see the remote component working in the host application."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pnpm start\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"End result",src:t(9179).A+"",width:"1196",height:"718"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},9179:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/end-result-ddfdc57eb7a6280b6c69492254f323a1.png"},4059:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/manifest-3024e344c03d4050d6bd18cfb9efc217.png"},4824:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>r});var o=t(9474);const i={},a=o.createContext(i);function l(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);